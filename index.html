<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title>Restart Schools</title>
    <!-- fonts -->
    <link href="https://fonts.googleapis.com/css?family=Lato:300i,400,400i,700,900" rel="stylesheet">
    <!-- Latest compiled and minified CSS -->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
    <script
      src="https://code.jquery.com/jquery-3.2.1.min.js"
      integrity="sha256-hwg4gsxgFZhOsEEamdOYGBf13FyQuiTwlAQgxVSNgt4="
      crossorigin="anonymous"></script>
    <!-- Latest compiled and minified JavaScript -->
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script>
    <link rel="stylesheet" href="css/main.css" type="text/css">
    <!-- d3 -->
    <script src="http://d3js.org/d3.v4.min.js" charset="utf-8"></script>
    <script src="http://d3js.org/topojson.v1.min.js"></script>
    <script src="https://d3js.org/d3-queue.v2.min.js"></script>
    <script src="data/restart-schools.geojson"></script>

    


    <!-- custom styles -->
    <link rel="stylesheet" href="css/main.css" type="text/css">

    <style>
     #append {
        padding: 0;
        margin: 0;
    }
    .county {
      stroke: #fff;
    } 

    .bar {
  fill: steelblue;
}

.bar:hover {
  fill: brown;
}

.axis--x path {
  display: none;
}
    </style>

  </head>
  <body>
    <div id="container" class="container">

     

        <div class="row">
          <div class="col-lg-4 big-text-col">
              <h1>Restart Schools Graphic</h1>
            <div id="trigger1" class="story text-wrapper">
                <p>There are 103 schools approved for restart status in North Carolina.</p>
              </div>
              <div class="story text-wrapper">
                  <p>Most restart schools are located in Durham, Rowan-Salisbury, Charlotte-Mecklenburg and Wake counties. When adjusted for population, Weldon City has the highest proportion of students in restart schools, with about 67 percent of their students in restart schools.</p>
                  <p>Top 10 Counties with Most Restart Schools</p>
                    <table class="table percent-table">
                      <tr>
                        <th>School district</th>
                        <th>Percent of students in restart schools</th>
                      </tr>
                      <tr data-fip="001">
                        <td>Alamance-Burlington</td>
                        <td>2.2%</td>
                      </tr>
                      <tr data-fip="015">
                        <td>Bertie</td>
                        <td>20.3</td>
                      </tr>
                      <tr data-fip="025">
                        <td>Cabarrus</td>
                        <td>11.7</td>
                      </tr>
                    </table>
              </div>
              <div id="trigger2" class="story text-wrapper">
                  <p>Lorem ipsum dolor sit amet, consectetur adipiscing elit. Donec euismod metus vel sem viverra, nec dignissim purus fringilla. Donec suscipit congue nunc, sit amet ultricies mi vestibulum dapibus. Ut et consectetur eros. Phasellus turpis nibh, placerat a neque sed, blandit aliquam quam. Vivamus hendrerit malesuada luctus. Nulla gravida orci non fringilla elementum. Praesent nisi metus, vulputate in purus et, pulvinar posuere tellus. Nulla facilisi. Quisque quis orci nec tortor dignissim pharetra ac nec orci. Mauris aliquet, metus id ultrices sagittis, neque dolor efficitur odio, vel ultricies neque elit eu libero. In suscipit libero purus, id rhoncus arcu venenatis in</p>
                </div>
                <div class="story text-wrapper">
                    <p>Lorem ipsum dolor sit amet, consectetur adipiscing elit. Donec euismod metus vel sem viverra, nec dignissim purus fringilla. Donec suscipit congue nunc, sit amet ultricies mi vestibulum dapibus. Ut et consectetur eros. Phasellus turpis nibh, placerat a neque sed, blandit aliquam quam. Vivamus hendrerit malesuada luctus. Nulla gravida orci non fringilla elementum. Praesent nisi metus, vulputate in purus et, pulvinar posuere tellus. Nulla facilisi. Quisque quis orci nec tortor dignissim pharetra ac nec orci. Mauris aliquet, metus id ultrices sagittis, neque dolor efficitur odio, vel ultricies neque elit eu libero. In suscipit libero purus, id rhoncus arcu venenatis in</p>
                  </div>
            </div>
            <div class="col-lg-8" style="position:fixed;">
                <div id="schools-map" class="story"></div>
            </div>
            <div id="bar-chart" class="story">
                <svg width="960" height="500"></svg>
            </div>
          </div>
  </div><!--container-->


      <script>

        $(document).ready(function(){

          //SCHOOLS MAP
          var width = window.innerWidth,
            height = window.innerHeight;

            var schools_svg = d3.select( "#schools-map" )
              .append( "svg" )
              .attr( "width", width )
              .attr( "height", height );

            var projection = d3.geoAlbers()
            .center([7, 35.73])
            .rotate([85.8,.5])
            .scale(8000)
            .translate([width / 2, height / 2]);

            var geoPath = d3.geoPath()
            .projection(projection);

            var q = d3_queue.queue();
            q
            .defer(d3.json, "data/nc-counties.json")
            .await(ready);

            function ready(error, counties){

            schools_svg.append("g")
                .selectAll("path")
                .data( topojson.feature(counties, counties.objects.counties).features)
                .enter()
                .append("path")
                .attr( "d", geoPath )
                .attr("class",function(d){
                  return "fip_" + d.properties.COUNTYFP + " county";
                })
                .attr( "fill", function(d){
                    return "#5656";
                }); 
            }

            var schools = schools_svg.append( "g" );

            schools.selectAll( "path" )
              .data( restartschools.features )
              .enter()
              .append( "path" )
              .attr("class", "school")
              .attr( "fill", "#900" )
              .attr( "stroke", "#999" )
              .attr( "d", geoPath );

            schools.selectAll( "path" )
              .data( restartschools.features )
              .enter()
              .append( "path" )
              .attr("class", "school")
              .attr( "fill", "#900" )
              .attr( "stroke", "#999" )
              .attr( "d", geoPath );


            //BASIC BAR CHART FROM BOSTOCK

            var bar_svg = d3.select("#bar-chart svg"),
                margin = {top: 20, right: 20, bottom: 30, left: 40},
                width = +bar_svg.attr("width") - margin.left - margin.right,
                height = +bar_svg.attr("height") - margin.top - margin.bottom;

            var x = d3.scaleBand().rangeRound([0, width]),
                y = d3.scaleLinear().rangeRound([height, 0]);

            var g = bar_svg.append("g")
                .attr("transform", "translate(" + margin.left + "," + margin.top + ")");

            d3.tsv("data/data.tsv", function(d) {
              d.frequency = +d.frequency;
              return d;
            }, function(error, data) {
              if (error) throw error;

              x.domain(data.map(function(d) { return d.letter; }));
              y.domain([0, d3.max(data, function(d) { return d.frequency; })]);

              g.append("g")
                  .attr("class", "axis axis--x")
                  .attr("transform", "translate(0," + height + ")")
                  .call(d3.axisBottom(x));

              g.append("g")
                  .attr("class", "axis axis--y")
                  .call(d3.axisLeft(y).ticks(5, "%"))
                .append("text")
                  .attr("transform", "rotate(-90)")
                  .attr("y", 6)
                  .attr("dy", "0.71em")
                  .attr("text-anchor", "end")
                  .text("Frequency");

              g.selectAll(".bar")
                .data(data)
                .enter().append("rect")
                  .attr("class", "bar")
                  .attr("y", function(d) { return x(d.letter); })
                  .attr("x", 0)
                  .attr("height", 10)
                  .attr("width", function(d) { return height - y(d.frequency); });
            });

            //SCROLLSTORY
            $(function(){
              $("#container").scrollStory({
                itemfocus: function(ev, item){
                  if (item.id === "trigger1"){
                    $('.school').toggleClass('school-show');
                  } else if (item.id === "trigger2"){
                    $('.school').toggleClass('school-show');
                    $('.county').toggleClass('county-show');
                  }
                  
            }
            });
            });

            $('.percent-table tr').hover(function(e){
              var thisFip = $(this).data('fip');
              console.log("fip_" + thisFip);

              $('.fip_' + thisFip).toggleClass('county-highlight');
            });
        }); //doc ready
       

    </script>
        <!-- scrollstory -->
        <script src="js/jquery.scrollstory.js"></script>
    </body>
    </html>