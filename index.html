<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title>Restart Schools</title>
    <!-- fonts -->
    <link href="https://fonts.googleapis.com/css?family=Lato:300i,400,400i,700,900" rel="stylesheet">
    <!-- Latest compiled and minified CSS -->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
    <script
      src="https://code.jquery.com/jquery-3.2.1.min.js"
      integrity="sha256-hwg4gsxgFZhOsEEamdOYGBf13FyQuiTwlAQgxVSNgt4="
      crossorigin="anonymous"></script>
    <!-- Latest compiled and minified JavaScript -->
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script>
    <link rel="stylesheet" href="css/main.css" type="text/css">
    <!-- d3 -->
    <script src="http://d3js.org/d3.v4.min.js" charset="utf-8"></script>
    <script src="http://d3js.org/topojson.v1.min.js"></script>
    <script src="https://d3js.org/d3-queue.v2.min.js"></script>
    <script src="data/restart-schools.geojson"></script>

    


    <!-- custom styles -->
    <link rel="stylesheet" href="css/main.css" type="text/css">

    <style>
     #append {
        padding: 0;
        margin: 0;
    }
    .county {
      stroke: #fff;
    } 

    .line {
        fill: none;
        stroke: steelblue;
        stroke-width: 2px;
        shape-rendering:crispEdges;
      }
      svg{
        shape-rendering:crispEdges;
      }

          .bar {
        fill: #6F257F;
      }
      .axis path,
      .axis line {
        fill: none;
        stroke: #D4D8DA;
        stroke-width: 1px;
        shape-rendering: crispEdges;
      }
      .x path {
        display: none;
      }
      .toolTip {
        position: absolute;
        display: none;
        min-width: 80px;
        height: auto;
        background: none repeat scroll 0 0 #ffffff;
        border: 1px solid #6F257F;
        padding: 14px;
        text-align: center;
      }

      .bar:hover {
        fill: brown;
      }

      .axis--x path {
        display: none;
      }
    </style>

  </head>
  <body>
      <div class="container-fluid" style="margin:0;">
          <div class="row">
            <div class="col-lg-12" style="padding:0;">
              <img src="images/header.jpg" alt="" style="width:100%;">
            </div>
          </div>
          <div class="row">
            <div class="col-lg-8 col-lg-offset-2">
                <p style="margin-top:20px;">THIS IS A COMPELLING LEDE. Donec euismod metus vel sem viverra, nec dignissim purus fringilla. Donec suscipit congue nunc, sit amet ultricies mi vestibulum dapibus. Ut et consectetur eros. Phasellus turpis nibh, placerat a neque sed, blandit aliquam quam. Vivamus hendrerit malesuada luctus. Nulla gravida orci non fringilla elementum. Praesent nisi metus, vulputate in purus et, pulvinar posuere tellus. Nulla facilisi. Quisque quis orci nec tortor dignissim pharetra ac nec orci. Mauris aliquet, metus id ultrices sagittis, neque dolor efficitur odio, vel ultricies neque elit eu libero. In suscipit libero purus, id rhoncus arcu venenatis in</p>
            </div>
          </div>
         </div>
    <div id="container" class="container">
        <div class="row">
          <div class="col-lg-4 big-text-col">
              <h1>Restart Schools Graphic</h1>
            <div id="trigger1" class="story text-wrapper">
                <p>There are 103 schools approved for restart status in North Carolina.</p>
              </div>
              <div class="story text-wrapper">
                  <p>Most restart schools are located in <span data-fip="063" class="map-link map-hover-item">Durham</span>, <span class="map-link map-hover-item" data-fip="159">Rowan-Salisbury</span>, and <span data-fip="183" class="map-link map-hover-item">Wake</span>  counties. When adjusted for population, <span data-fip="083" class="map-link map-hover-item">Weldon City Public Schools</span> in Halifax County has the highest proportion of students in restart schools, with about 67 percent of their students in restart schools.</p>
                  <p>Top 10 Counties with Most Restart Schools</p>
                    <table class="table percent-table">
                      <tr>
                        <th>School district</th>
                        <th>Percent of students in restart schools</th>
                      </tr>
                      <tr data-fip="001" class="map-hover-item">
                        <td>Alamance-Burlington</td>
                        <td>2.2%</td>
                      </tr>
                      <tr data-fip="015" class="map-hover-item">
                        <td>Bertie</td>
                        <td>20.3</td>
                      </tr>
                      <tr data-fip="025" class="map-hover-item">
                        <td>Cabarrus</td>
                        <td>11.7</td>
                      </tr>
                    </table>
              </div>
              <div id="trigger2" class="story text-wrapper">
                  <p>Lorem ipsum dolor sit amet, consectetur adipiscing elit. Donec euismod metus vel sem viverra, nec dignissim purus fringilla. Donec suscipit congue nunc, sit amet ultricies mi vestibulum dapibus. Ut et consectetur eros. Phasellus turpis nibh, placerat a neque sed, blandit aliquam quam. Vivamus hendrerit malesuada luctus. Nulla gravida orci non fringilla elementum. Praesent nisi metus, vulputate in purus et, pulvinar posuere tellus. Nulla facilisi. Quisque quis orci nec tortor dignissim pharetra ac nec orci. Mauris aliquet, metus id ultrices sagittis, neque dolor efficitur odio, vel ultricies neque elit eu libero. In suscipit libero purus, id rhoncus arcu venenatis in</p>
              </div>
              <div class="story text-wrapper">
                  <p>Lorem ipsum dolor sit amet, consectetur adipiscing elit. Donec euismod metus vel sem viverra, nec dignissim purus fringilla. Donec suscipit congue nunc, sit amet ultricies mi vestibulum dapibus. Ut et consectetur eros. Phasellus turpis nibh, placerat a neque sed, blandit aliquam quam. Vivamus hendrerit malesuada luctus. Nulla gravida orci non fringilla elementum. Praesent nisi metus, vulputate in purus et, pulvinar posuere tellus. Nulla facilisi. Quisque quis orci nec tortor dignissim pharetra ac nec orci. Mauris aliquet, metus id ultrices sagittis, neque dolor efficitur odio, vel ultricies neque elit eu libero. In suscipit libero purus, id rhoncus arcu venenatis in</p>
              </div>
              <div id="bar-chart" class="story">
                  <svg width="400" height="200"></svg>
              </div>
              <div class="story text-wrapper">
                  <p>Lorem ipsum dolor sit amet, consectetur adipiscing elit. Donec euismod metus vel sem viverra, nec dignissim purus fringilla. Donec suscipit congue nunc, sit amet ultricies mi vestibulum dapibus. Ut et consectetur eros. Phasellus turpis nibh, placerat a neque sed, blandit aliquam quam. Vivamus hendrerit malesuada luctus. Nulla gravida orci non fringilla elementum. Praesent nisi metus, vulputate in purus et, pulvinar posuere tellus. Nulla facilisi. Quisque quis orci nec tortor dignissim pharetra ac nec orci. Mauris aliquet, metus id ultrices sagittis, neque dolor efficitur odio, vel ultricies neque elit eu libero. In suscipit libero purus, id rhoncus arcu venenatis in</p>
              </div>
              <div class="story text-wrapper">
                  <p>Lorem ipsum dolor sit amet, consectetur adipiscing elit. Donec euismod metus vel sem viverra, nec dignissim purus fringilla. Donec suscipit congue nunc, sit amet ultricies mi vestibulum dapibus. Ut et consectetur eros. Phasellus turpis nibh, placerat a neque sed, blandit aliquam quam. Vivamus hendrerit malesuada luctus. Nulla gravida orci non fringilla elementum. Praesent nisi metus, vulputate in purus et, pulvinar posuere tellus. Nulla facilisi. Quisque quis orci nec tortor dignissim pharetra ac nec orci. Mauris aliquet, metus id ultrices sagittis, neque dolor efficitur odio, vel ultricies neque elit eu libero. In suscipit libero purus, id rhoncus arcu venenatis in</p>
              </div>
            </div><!--.col-lg-4-->
            <div class="col-lg-8" style="">
                <div id="schools-map" class="story">
                  <svg style="margin-left:400;"></svg>
                </div>
            </div>
           
            <div id="line-chart" class="story">
                <svg width="400" height="200"></svg>
  
              </div>
          </div>
  </div><!--container-->


      <script>

        $(document).ready(function(){

          //SCHOOLS MAP
          var width = window.innerWidth-300,
            height = window.innerHeight;

            var schools_svg = d3.select( "#schools-map svg" )
              .attr( "width", width )
              .attr( "height", height );

            var projection = d3.geoAlbers()
            .center([7, 35.73])
            .rotate([85.8,.5])
            .scale(6000)
            .translate([width / 2, height / 2]);

            var geoPath = d3.geoPath()
            .projection(projection);

            var q = d3_queue.queue();
            q
            .defer(d3.json, "data/nc-counties.json")
            .await(ready);

            function ready(error, counties){

            schools_svg.append("g")
                .selectAll("path")
                .data( topojson.feature(counties, counties.objects.counties).features)
                .enter()
                .append("path")
                .attr( "d", geoPath )
                .attr("class",function(d){
                  return "fip_" + d.properties.COUNTYFP + " county";
                })
                .attr( "fill", function(d){
                    return "#5656";
                }); 
            }

            var schools = schools_svg.append( "g" );

            schools.selectAll( "path" )
              .data( restartschools.features )
              .enter()
              .append( "path" )
              .attr("class", "school")
              .attr( "fill", "#900" )
              .attr( "stroke", "#999" )
              .attr( "d", geoPath );

            schools.selectAll( "path" )
              .data( restartschools.features )
              .enter()
              .append( "path" )
              .attr("class", "school")
              .attr( "fill", "#900" )
              .attr( "stroke", "#999" )
              .attr( "d", geoPath );


            //BASIC BAR CHART - https://bl.ocks.org/alandunning/7008d0332cc28a826b37b3cf6e7bd998

            var bar_svg = d3.select("#bar-chart svg"),
            bar_margin = {top: 20, right: 20, bottom: 30, left: 80},
            bar_width = +bar_svg.attr("width") - bar_margin.left - bar_margin.right,
            bar_height = +bar_svg.attr("height") - bar_margin.top - bar_margin.bottom;
          
            // var tooltip = d3.select("body").append("div").attr("class", "toolTip");
              
            var bar_x = d3.scaleLinear().range([0, bar_width]);
            var bar_y = d3.scaleBand().range([bar_height, 0]);
            
            var g = bar_svg.append("g")
                .attr("transform", "translate(" + bar_margin.left + "," + bar_margin.top + ")");
              
            d3.json("data/data.json", function(error, data) {
                if (error) throw error;
              
                data.sort(function(a, b) { return a.value - b.value; });
              
                bar_x.domain([0, d3.max(data, function(d) { return d.value; })]);
                bar_y.domain(data.map(function(d) { return d.area; })).padding(0.1);
            
                g.append("g")
                    .attr("class", "x axis")
                    .attr("transform", "translate(0," + bar_height + ")")
                    .call(d3.axisBottom(bar_x).ticks(5).tickFormat(function(d) { return parseInt(d / 1000); }).tickSizeInner([-bar_height]));
            
                g.append("g")
                    .attr("class", "y axis")
                    .call(d3.axisLeft(bar_y));
            
                g.selectAll(".bar")
                    .data(data)
                  .enter().append("rect")
                    .attr("class", "bar")
                    .attr("x", 0)
                    .attr("height", bar_y.bandwidth())
                    .attr("y", function(d) { return bar_y(d.area); })
                    .attr("width", function(d) { return bar_x(d.value); });
                    // .on("mousemove", function(d){
                    //     tooltip
                    //       .style("left", d3.event.pageX - 50 + "px")
                    //       .style("top", d3.event.pageY - 70 + "px")
                    //       .style("display", "inline-block")
                    //       .html((d.area) + "<br>" + "Â£" + (d.value));
                    // })
                    // .on("mouseout", function(d){ tooltip.style("display", "none");});
            });


            //BASIC LINE CHART
            // set the dimensions and margins of the graph
            var line_margin = {top: 20, right: 40, bottom: 30, left: 50},
                line_width = 960 - line_margin.left - line_margin.right,
                line_height = 500 - line_margin.top - line_margin.bottom;

            // parse the date / time
            var parseTime = d3.timeParse("%d-%b-%y");

            // set the ranges
            var line_x = d3.scaleTime().range([0, line_width]);
            var line_y = d3.scaleLinear().range([line_height, 0]);

            // define the 1st line
            var valueline = d3.line()
                .x(function(d) { return line_x(d.date); })
                .y(function(d) { return line_y(d.close); });

            // define the 2nd line
            var valueline2 = d3.line()
                .x(function(d) { return line_x(d.date); })
                .y(function(d) { return line_y(d.open); });

            // append the svg obgect to the body of the page
            // appends a 'group' element to 'svg'
            // moves the 'group' element to the top left margin
            var line_svg = d3.select("#line-chart svg");

            line_svg
                .attr("width", line_width + line_margin.left + line_margin.right)
                .attr("height", line_height + line_margin.top + line_margin.bottom)
              .append("g")
                .attr("transform",
                      "translate(" + line_margin.left + "," + line_margin.top + ")");

            // Get the data
            d3.csv("data/data2.csv", function(error, data) {
              if (error) throw error;

              // format the data
              data.forEach(function(d) {
                  d.date = parseTime(d.date);
                  d.close = +d.close;
                  d.open = +d.open;
              });

              // Scale the range of the data
              line_x.domain(d3.extent(data, function(d) { return d.date; }));
              line_y.domain([0, d3.max(data, function(d) {
                return Math.max(d.close, d.open); })]);

              // Add the valueline path.
              line_svg.append("path")
                  .data([data])
                  .attr("class", "line")
                  .attr("d", valueline);

              // Add the valueline2 path.
              line_svg.append("path")
                  .data([data])
                  .attr("class", "line")
                  .style("stroke", "red")
                  .attr("d", valueline2);

              // Add the X Axis
              line_svg.append("g")
                  .attr("class", "xaxis")
                  .attr("transform", "translate(0," + line_height + ")")
                  .call(d3.axisBottom(line_x));

              // Add the Y Axis
              line_svg.append("g")
                  .attr("class", "yaxis")
                  .call(d3.axisLeft(line_y));

              line_svg.append("text")
                  .attr("transform", "translate("+(line_width+3)+","+line_y(data[0].open)+")")
                  .attr("dy", ".35em")
                  .attr("text-anchor", "start")
                  .style("fill", "red")
                  .text("Open");

              line_svg.append("text")
                  .attr("transform", "translate("+(line_width+3)+","+line_y(data[0].close)+")")
                  .attr("dy", ".35em")
                  .attr("text-anchor", "start")
                  .style("fill", "steelblue")
                  .text("Close");

            });

            //SCROLLSTORY
            $(function(){
              $("#container").scrollStory({
                itemfocus: function(ev, item){
                  if (item.id === "trigger1"){
                    $('.school').toggleClass('school-show');
                  } else if (item.id === "trigger2"){
                    $('.school').toggleClass('school-show');
                    $('.county').toggleClass('county-show');
                  }
                  
            }
            });
            });

            $('.map-hover-item').hover(function(e){
              var thisFip = $(this).data('fip');
              console.log("fip_" + thisFip);

              $('.fip_' + thisFip).toggleClass('county-highlight');
            });
        }); //doc ready
       

    </script>
        <!-- scrollstory -->
        <script src="js/jquery.scrollstory.js"></script>
    </body>
    </html>