<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title>Restart Schools</title>
    <!-- fonts -->
    <link href="https://fonts.googleapis.com/css?family=Lato:300i,400,400i,700,900" rel="stylesheet">
    <!-- Latest compiled and minified CSS -->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
    <script
      src="https://code.jquery.com/jquery-3.2.1.min.js"
      integrity="sha256-hwg4gsxgFZhOsEEamdOYGBf13FyQuiTwlAQgxVSNgt4="
      crossorigin="anonymous"></script>
    <!-- Latest compiled and minified JavaScript -->
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script>
    <link rel="stylesheet" href="css/main.css" type="text/css">
    <!-- d3 -->
    <script src="http://d3js.org/d3.v4.min.js" charset="utf-8"></script>
    <script src="http://d3js.org/topojson.v1.min.js"></script>
    <script src="https://d3js.org/d3-queue.v2.min.js"></script>
    <script src="data/restart-schools.geojson"></script>

   
    


    <!-- custom styles -->
    <link rel="stylesheet" href="css/main.css" type="text/css">

    <style>
     #append {
        padding: 0;
        margin: 0;
    }
    .county {
      stroke: #fff;
    } 

    .line {
        fill: none;
        stroke: steelblue;
        stroke-width: 2px;
        shape-rendering:crispEdges;
      }
      svg{
        shape-rendering:crispEdges;
      }

          .bar {
        fill: #6F257F;
      }
      .axis path,
      .axis line {
        fill: none;
        stroke: #D4D8DA;
        stroke-width: 1px;
        shape-rendering: crispEdges;
      }
      .x path {
        display: none;
      }
      .toolTip {
        position: absolute;
        display: none;
        min-width: 80px;
        height: auto;
        background: none repeat scroll 0 0 #ffffff;
        border: 1px solid #6F257F;
        padding: 14px;
        text-align: center;
      }

      .bar:hover {
        fill: brown;
      }

      .axis--x path {
        display: none;
      }
    </style>

  </head>
  <body>
      <div class="container-fluid" style="margin:0;">
          <div class="row">
            <div class="col-lg-12" style="padding:0;">
              <img src="images/header.jpg" alt="" style="width:100%;">
            </div>
          </div>
          <div class="row">
            <div class="col-lg-8 col-lg-offset-2">
                <p style="margin-top:20px;">THIS IS A COMPELLING LEDE. Donec euismod metus vel sem viverra, nec dignissim purus fringilla. Donec suscipit congue nunc, sit amet ultricies mi vestibulum dapibus. Ut et consectetur eros. Phasellus turpis nibh, placerat a neque sed, blandit aliquam quam. Vivamus hendrerit malesuada luctus. Nulla gravida orci non fringilla elementum. Praesent nisi metus, vulputate in purus et, pulvinar posuere tellus. Nulla facilisi. Quisque quis orci nec tortor dignissim pharetra ac nec orci. Mauris aliquet, metus id ultrices sagittis, neque dolor efficitur odio, vel ultricies neque elit eu libero. In suscipit libero purus, id rhoncus arcu venenatis in</p>
            </div>
          </div>
         </div>
    <div id="container" class="container">
        <div class="row">
          <div class="col-lg-4 big-text-col">
              <h1>Restart Schools Graphic</h1>
            <div id="waypoint1" class="story text-wrapper">
                <p>There are 103 schools approved for restart status in North Carolina.</p>
              </div>
              <div class="story text-wrapper">
                  <p>Most restart schools are located in <span data-fip="063" class="map-link map-hover-item">Durham</span>, <span class="map-link map-hover-item" data-fip="159">Rowan-Salisbury</span>, and <span data-fip="183" class="map-link map-hover-item">Wake</span>  counties. When adjusted for population, <span data-fip="083" class="map-link map-hover-item">Weldon City Public Schools</span> in Halifax County has the highest proportion of students in restart schools, with about 67 percent of their students in restart schools.</p>
                  <p>Top 10 Counties with Most Restart Schools</p>
                    <table class="table percent-table">
                      <tr>
                        <th>School district</th>
                        <th>Percent of students in restart schools</th>
                      </tr>
                      <tr data-fip="001" class="map-hover-item">
                        <td>Alamance-Burlington</td>
                        <td>2.2%</td>
                      </tr>
                      <tr data-fip="015" class="map-hover-item">
                        <td>Bertie</td>
                        <td>20.3</td>
                      </tr>
                      <tr data-fip="025" class="map-hover-item">
                        <td>Cabarrus</td>
                        <td>11.7</td>
                      </tr>
                    </table>
              </div>
              <div id="waypoint2" class="story text-wrapper">
                  <p>text: [some number] out of the 103 restart schools have had a median student performance grade below [some number] in the last three years.
                      show: a line plot of the student performance grades compared to statewide median like in my original sketch</p>
              </div>
              <div class="story text-wrapper">
                  <p>show: a bar graph like the one in my original sketch showing racial/ethnic breakdown, but with two sets of bars to compare statewide vs restart
                      text: (some sentence describing an interesting pullout from this data)</p>
              </div>
              
              <div id="waypoint3" class="story text-wrapper">
                  <p>The percentage of economically disadvantaged students is reported by the state in ranges: 

                      (Draw an svg line showing the ranges)
                      
                
                      </p>
              </div>
              <div class="story text-wrapper">
                  <p> The median percentage of economically disadvantaged students in the state is between 60 and 65%.
                      
                      (Highlight this range on the line)
                  </p>
              </div>
              <div class="story text-wrapper">
                <p>The median percentage of economically disadvantaged students in restart schools is greater than 90%.
                      
                    (Highlight this range on the line)</p>
              </div>
            </div><!--.col-lg-4-->
            <div class="col-lg-8">
                <div id="schools-map" class="story">
                  <svg></svg>
                </div>
                <div id="line-chart" class="story" style="display:none;">
                    <svg width="960" height="500"></svg>
                  </div>
                <div id="bar-chart" class="story" style="display:none;">
                    <svg width="400" height="200"></svg>
                </div>
            </div>
           
            
          </div>
  </div><!--container-->


      <script>

        $(document).ready(function(){

          //SCHOOLS MAP
          var schools_width = window.innerWidth-300,
          schools_height = window.innerHeight;

            var schools_svg = d3.select( "#schools-map svg" )
              .attr( "width", schools_width )
              .attr( "height", schools_height );

            var projection = d3.geoAlbers()
            .center([7, 35.73])
            .rotate([85.8,.5])
            .scale(6000)
            .translate([schools_width / 2, schools_height / 2]);

            var geoPath = d3.geoPath()
            .projection(projection);

            var q = d3_queue.queue();
            q
            .defer(d3.json, "data/nc-counties.json")
            .await(ready);

            function ready(error, counties){

            schools_svg.append("g")
                .selectAll("path")
                .data( topojson.feature(counties, counties.objects.counties).features)
                .enter()
                .append("path")
                .attr( "d", geoPath )
                .attr("class",function(d){
                  return "fip_" + d.properties.COUNTYFP + " county";
                })
                .attr( "fill", function(d){
                    return "#5656";
                }); 
            }

            var schools = schools_svg.append( "g" );

            schools.selectAll( "path" )
              .data( restartschools.features )
              .enter()
              .append( "path" )
              .attr("class", "school")
              .attr( "fill", "#900" )
              .attr( "stroke", "#999" )
              .attr( "d", geoPath );

            schools.selectAll( "path" )
              .data( restartschools.features )
              .enter()
              .append( "path" )
              .attr("class", "school")
              .attr( "fill", "#900" )
              .attr( "stroke", "#999" )
              .attr( "d", geoPath );


            //BASIC BAR CHART - https://bl.ocks.org/alandunning/7008d0332cc28a826b37b3cf6e7bd998

            var bar_svg = d3.select("#bar-chart svg"),
            bar_margin = {top: 20, right: 20, bottom: 30, left: 100},
            bar_width = +bar_svg.attr("width") - bar_margin.left - bar_margin.right,
            bar_height = +bar_svg.attr("height") - bar_margin.top - bar_margin.bottom;
          
            // var tooltip = d3.select("body").append("div").attr("class", "toolTip");
              
            var bar_x = d3.scaleLinear().range([0, bar_width]);
            var bar_y = d3.scaleBand().range([bar_height, 0]);
            
            var g = bar_svg.append("g")
                .attr("transform", "translate(" + bar_margin.left + "," + bar_margin.top + ")");
              
            d3.json("data/restart_race.json", function(error, data) {
                if (error) throw error;
              
                data.sort(function(a, b) { return a.value - b.value; });
              
                // bar_x.domain([0, d3.max(data, function(d) { return d.value; })]);
                bar_x.domain([0,1]);
                bar_y.domain(data.map(function(d) { return d.label; })).padding(0.1);
            
                g.append("g")
                    .attr("class", "x axis")
                    .attr("transform", "translate(0," + bar_height + ")")
                    .call(d3.axisBottom(bar_x).ticks(5).tickFormat(function(d) { return parseFloat(d)*100 + '%'; }).tickSizeInner([-bar_height]));
            
                g.append("g")
                    .attr("class", "y axis")
                    .call(d3.axisLeft(bar_y));
            
                var bar = g.selectAll(".bar")
                    .data(data)
                  .enter().append("rect")
                    .attr("class", "bar")
                    .attr("x", 0)
                    .attr("height", bar_y.bandwidth())
                    .attr("y", function(d) { return bar_y(d.label); })
                    .attr("width", function(d) { console.log(d); return bar_x(d.value); })
                    .style('fill', '#BFDEFF')
                    .on('mouseover', function () {
                        d3.select(this).transition().style('fill', '#2B24FF');
                    })
                    .on('mouseout', function () {
                        d3.select(this).transition().style('fill', '#BFDEFF');
                    });
                    
                    bar.append("text")
                      .attr("class", "label")
                      .attr("y", bar_height / 2)
                      .attr("dy", ".35em") //vertical align middle
                      .text(function(d){
                          return d.value;
                      });
                    
                    
                    // .on("mousemove", function(d){
                    //     tooltip
                    //       .style("left", d3.event.pageX - 50 + "px")
                    //       .style("top", d3.event.pageY - 70 + "px")
                    //       .style("display", "inline-block")
                    //       .html((d.area) + "<br>" + "£" + (d.value));
                    // })
                    // .on("mouseout", function(d){ tooltip.style("display", "none");});
            });


//MULTI-SERIES LINE CHART - https://bl.ocks.org/mbostock/3884955

        var line_svg = d3.select("#line-chart svg"),
        line_margin = {top: 20, right: 80, bottom: 30, left: 50},
        line_width = line_svg.attr("width") - line_margin.left - line_margin.right,
        line_height = line_svg.attr("height") - line_margin.top - line_margin.bottom,
        line_g = line_svg.append("g").attr("transform", "translate(" + line_margin.left + "," + line_margin.top + ")");
        
        var parseTime = d3.timeParse("%Y%m%d");
        
        var line_x = d3.scaleTime().range([0, line_width]),
        line_y = d3.scaleLinear().range([line_height, 0]),
        line_z = d3.scaleOrdinal(d3.schemeCategory10);
        
        var line = d3.line()
            .curve(d3.curveBasis)
            .x(function(d) { return line_x(d.date); })
            .y(function(d) { return line_y(d.temperature); });
        
        d3.tsv("data/example.tsv", type, function(error, data) {
          if (error) throw error;
        
          var cities = data.columns.slice(1).map(function(id) {
            return {
              id: id,
              values: data.map(function(d) {
                return {date: d.date, temperature: d[id]};
              })
            };
          });
        
          line_x.domain(d3.extent(data, function(d) { return d.date; }));
        
          line_y.domain([
            d3.min(cities, function(c) { return d3.min(c.values, function(d) { return d.temperature; }); }),
            d3.max(cities, function(c) { return d3.max(c.values, function(d) { return d.temperature; }); })
          ]);
        
          line_z.domain(cities.map(function(c) { return c.id; }));
        
          line_g.append("g")
              .attr("class", "axis axis--x")
              .attr("transform", "translate(0," + line_height + ")")
              .call(d3.axisBottom(line_x));
        
          line_g.append("g")
              .attr("class", "axis axis--y")
              .call(d3.axisLeft(line_y))
            .append("text")
              .attr("transform", "rotate(-90)")
              .attr("y", 6)
              .attr("dy", "0.71em")
              .attr("fill", "#000")
              .text("Temperature, ºF");
        
          var city = line_g.selectAll(".city")
            .data(cities)
            .enter().append("g")
              .attr("class", "city");
        
          city.append("path")
              .attr("class", "line")
              .attr("d", function(d) { return line(d.values); })
              .style("stroke", function(d) { return line_z(d.id); });
        
          city.append("text")
              .datum(function(d) { return {id: d.id, value: d.values[d.values.length - 1]}; })
              .attr("transform", function(d) { return "translate(" + line_x(d.value.date) + "," + line_y(d.value.temperature) + ")"; })
              .attr("x", 3)
              .attr("dy", "0.35em")
              .style("font", "10px sans-serif")
              .text(function(d) { return d.id; });
            });
            
            function type(d, _, columns) {
              d.date = parseTime(d.date);
              for (var i = 1, n = columns.length, c; i < n; ++i) d[c = columns[i]] = +d[c];
              return d;
            }


      //WAYPOINTS
            var waypoint = new Waypoint({
              element: document.getElementById('waypoint1'),
              handler: function() {
                $('#schools-map svg').toggleClass("fixed");
                
              }
            })

            //trigger the line chart
            var waypoint = new Waypoint({
              element: document.getElementById('waypoint2'),
              handler: function() {
                $('#line-chart').toggleClass("inline-block");
                $('#schools-map svg').toggleClass("fixed");
                $('#line-chart svg').toggleClass("fixed");
                
              }
            })

            //trigger the bar chart
            var waypoint = new Waypoint({
              element: document.getElementById('waypoint3'),
              handler: function() {
                $('#line-chart').toggleClass("inline-block");
                $('#bar-chart').toggleClass("inline-block");
                $('#line-chart svg').toggleClass("fixed");
                $('#bar-chart svg').toggleClass("fixed");
                
              }
            })


            $('.map-hover-item').hover(function(e){
              var thisFip = $(this).data('fip');
              console.log("fip_" + thisFip);

              $('.fip_' + thisFip).toggleClass('county-highlight');
            });
        }); //doc ready
       

    </script>
        <!-- waypoints -->
        <script src="js/jquery.waypoints.min.js"></script>

    </body>
    </html>